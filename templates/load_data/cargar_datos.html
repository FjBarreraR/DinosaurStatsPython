<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sincronizaci贸n de Datos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/external-resource/bootstrap-icons/font/bootstrap-icons.css">
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6">

            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <div class="card border-0 shadow-lg">
                <div class="card-body p-5 text-center">
                    <div class="display-1 text-primary mb-4">
                        <i class="bi bi-cloud-arrow-down"></i> 
                    </div>

                    <h2 class="fw-bold">Sincronizar Inventario</h2>
                    <p class="text-muted mb-4">
                        Al hacer clic en el bot贸n, el sistema se conectar谩 a la API externa para descargar y actualizar los productos en tu base de datos local.
                    </p>

                    <hr class="my-4">

                    <div class="d-grid gap-2">
                        <form action="{% url 'cargar_datos' %}" method="post" id="form-sincronizar">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary btn-lg w-100" id="btn-submit">
                                <strong>Iniciar Importaci贸n</strong>
                            </button>
                        </form>

                        <a href="{% url 'home' %}" class="btn btn-outline-secondary">
                            Volver al home
                        </a>
                    </div>
                </div>

                <div class="card-footer bg-white text-center py-3">
                    <small class="text-muted">
                        <span class="badge bg-info text-dark">Nota:</span>
                        Este proceso puede tardar unos segundos dependiendo de la API.
                    </small>
                </div>
            </div>

            <div id="loading-state" class="text-center mt-4" style="display: none;">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="mt-2 text-primary fw-bold">Conectando con la API... por favor espera.</p>
            </div>

        </div>
    </div>
</div>

<script>
    const form = document.getElementById('form-sincronizar');
    const btn = document.getElementById('btn-submit');
    const loading = document.getElementById('loading-state');

    form.onsubmit = function() {
        btn.disabled = true; // Desactiva el bot贸n para que no den mil clics
        btn.innerText = "Procesando...";
        loading.style.display = "block"; // Muestra el spinner
    };
</script>

</body>
</html>